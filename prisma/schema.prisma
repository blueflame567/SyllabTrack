// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(cuid())
  clerkId           String   @unique
  email             String   @unique
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Subscription info
  subscriptionTier  String   @default("free") // "free" or "premium"
  stripeCustomerId  String?  @unique
  stripeSubscriptionId String? @unique
  subscriptionStatus String? // "active", "canceled", "past_due", etc.
  subscriptionEndsAt DateTime?

  // Usage tracking
  usageRecords      UsageRecord[]
  syllabi           Syllabus[]
}

model UsageRecord {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  // What month this usage is for (for tracking monthly limits)
  month     Int      // 1-12
  year      Int      // 2024, 2025, etc.

  @@index([userId, year, month])
  @@unique([userId, createdAt])
}

model Syllabus {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Syllabus info
  courseName  String?
  fileName    String
  fileType    String   // "pdf" or "docx"
  rawText     String   @db.Text

  // Metadata
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  events      Event[]

  @@index([userId])
  @@index([createdAt])
}

model Event {
  id          String   @id @default(cuid())
  syllabusId  String
  syllabus    Syllabus @relation(fields: [syllabusId], references: [id], onDelete: Cascade)

  // Event details
  title       String
  start       DateTime
  end         DateTime?
  description String?  @db.Text
  location    String?

  // Event categorization
  type        String?  // "assignment", "exam", "reading", "class", "other"

  // Metadata
  createdAt   DateTime @default(now())

  @@index([syllabusId])
  @@index([start])
  @@index([type])
}
